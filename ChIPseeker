#!/bin/bash

> library(GenomicFeatures)

> txdb <- makeTxDbFromGFF("hmi_annotated_rna.gff", format="gff", dataSource=NA, organism=NA, taxonomyId=NA, circ_seqs=DEFAULT_CIRC_SEQS, chrominfo=NULL, miRBaseBuild=NA)

#Import genomic features from the file as a GRanges object ... OK
#Prepare the 'metadata' data frame ... OK
#Make the TxDb object ... OK
#Warning message:
#call dbDisconnect() when finished working with a connection 

> txdb
TxDb object:
# Db type: TxDb
# Supporting package: GenomicFeatures
# Data source: hmi_annotated.gtf
# Organism: NA
# Taxonomy ID: NA
# miRBase build ID: NA
# Genome: NA
# transcript_nrow: 22632
# exon_nrow: 112711
# cds_nrow: 22632
# Db created by: GenomicFeatures package from Bioconductor
# Creation time: 2017-12-28 21:41:49 -0500 (Thu, 28 Dec 2017)
# GenomicFeatures version at creation time: 1.28.5
# RSQLite version at creation time: 2.0
# DBSCHEMAVERSION: 1.1

> peakAnno <- annotatePeak("consensus_peakset_clean_FINAL.txt", TxDb=txdb)
>> loading peak file...				 2017-12-28 21:43:03 
>> preparing features information...		 2017-12-28 21:43:03 
>> identifying nearest features...		 2017-12-28 21:43:03 
>> calculating distance from peak to TSS...	 2017-12-28 21:43:04 
>> assigning genomic annotation...		 2017-12-28 21:43:04 
>> assigning chromosome lengths			 2017-12-28 21:43:07 
>> done...					 2017-12-28 21:43:07 

> annotatePeak("consensus_peakset_clean_FINAL.txt", TxDb = txdb, level = "transcript", assignGenomicAnnotation = TRUE, genomicAnnotationPriority = c("Promoter", "5UTR", "3UTR", "Exon", "Intron", "Intergenic"), annoDb = NULL, addFlankGeneInfo = FALSE, flankDistance = 5000, sameStrand = FALSE, ignoreOverlap = FALSE, ignoreUpstream = FALSE, ignoreDownstream = FALSE, overlap = "TSS", verbose = TRUE)
>> loading peak file...				 2017-12-28 21:46:38 
>> preparing features information...		 2017-12-28 21:46:38 
>> identifying nearest features...		 2017-12-28 21:46:38 
>> calculating distance from peak to TSS...	 2017-12-28 21:46:39 
>> assigning genomic annotation...		 2017-12-28 21:46:39 
>> assigning chromosome lengths			 2017-12-28 21:46:40 
>> done...					 2017-12-28 21:46:40 
Annotated peaks generated by ChIPseeker
35933/36322  peaks were annotated
Genomic Annotation Summary:
             Feature   Frequency
7   Promoter (<=1kb) 18.26176495
8   Promoter (1-2kb)  4.78668633
9   Promoter (2-3kb)  4.51673949
2             5' UTR  8.74961734
5         Other Exon  0.01113183
1         1st Intron  8.65221384
6       Other Intron 29.39915955
4 Downstream (<=3kb)  1.38591267
3  Distal Intergenic 24.23677400
Warning messages:
> options(ChIPseeker.ignore_1st_exon = TRUE)
> options(ChIPseeker.ignore_1st_intron = TRUE)
> options(ChIPseeker.ignore_downstream = TRUE)
> options(ChIPseeker.ignore_promoter_subcategory = TRUE)
# making a marplot to compare annotations with multiple samples
> peakAnno <- annotatePeak("0h_consensus.txt", TxDb=txdb)
> peakAnno3h <- annotatePeak("3h_consensus.txt", TxDb=txdb)
> plotAnnoBar(list(an1=peakAnno, an2=peakAnno3h))
